# 实验二：全局训练动态 (Figure 2) 复现报告

## 概述

本实验复现了论文 "Liquid and solid layers in a thermal deep learning machine" 中的 Figure 2，研究热力学深度学习机 (TDLM) 的全局训练动态。

## 实验目标

测量以下物理量随时间的演化：

1. **能量衰减** E(t)/E(0) - 系统能量相对于初始能量的比值
2. **训练准确率** A_train(t) - 使用 DNN 前向传播计算的训练集准确率
3. **测试准确率** A_test(t) - 使用 DNN 前向传播计算的测试集准确率
4. **自旋自相关函数** c(t, t_w) - 测量系统在等待时间 t_w 后的自相关
5. **副本间重叠** q(t, t_w) - 两个共享权重但独立演化的副本之间的重叠

## 实验配置

### 数据集
- **数据源**: 真实 MNIST 数据集（数字 0 和 1）
- **预处理**: 像素二值化（>127.5 → +1, 否则 → -1）
- **训练集**: 300 样本
- **测试集**: 60 样本

### 网络参数
- **层数 L**: 8
- **逆温度 β**: 10^5
- **MC 步数**: 1000
- **等待时间 t_w**: [100, 300, 600]

### 配置变化（不同的 α = M/N）
| 配置 | N | α | ln α |
|------|---|---|------|
| 1 | 30 | 10.0 | 2.30 |
| 2 | 15 | 20.0 | 3.00 |
| 3 | 8 | 37.5 | 3.62 |

## 实验结果

### 最终值摘要

| ln α | α | E*/E(0) | A*_train | A*_test |
|------|---|---------|----------|---------|
| 2.30 | 10.0 | 2.96×10⁻³ | 0.340 | 0.267 |
| 3.00 | 20.0 | 4.69×10⁻³ | 0.337 | 0.217 |
| 3.62 | 37.5 | 2.38×10⁻³ | 0.527 | 0.417 |

### 关键观察

1. **能量衰减 (图 a)**
   - 所有配置的能量都呈现幂律衰减
   - 较大的 α（较小的 N）导致更快的能量衰减
   - 最终能量比约为 10⁻³ 量级

2. **训练准确率 (图 b)**
   - 准确率随训练逐渐提升
   - 较大的 α 配置（ln α = 3.62）表现最好，达到约 0.53
   - 存在一定的波动，这是 MC 采样的固有特性

3. **测试准确率 (图 c)**
   - 测试准确率与训练准确率趋势相似
   - 最佳测试准确率约为 0.42（ln α = 3.62）
   - 表明网络具有一定的泛化能力

4. **自旋自相关函数 (图 e)**
   - c(t, t_w) 保持接近 1，表明系统记忆性强
   - 不同 t_w 的曲线几乎重合
   - 这与论文中描述的"固态"行为一致

5. **副本间重叠 (图 f)**
   - q(t, t_w) 稳定在约 0.15 左右
   - 表明两个副本的隐藏层配置有一定程度的独立性

6. **层自相关 (图 g)**
   - 所有层的自相关都保持很高（>0.9）
   - 不同层之间差异较小
   - 表明整个网络处于相对稳定的状态

7. **层重叠 (图 h)**
   - 第一层（l=1）的重叠最高，约 0.6
   - 深层的重叠较低，约 0.05-0.2
   - 这表明靠近输入的层更加"固化"

## 与论文的比较

### 一致性
- 能量的幂律衰减行为与论文一致
- 自相关函数保持高值的特性与论文描述的"固态"相符
- 层重叠显示出深浅层差异的趋势

### 差异
- 由于计算资源限制，使用了较小的数据集和较少的 MC 步数
- 测试准确率略低于论文报告的值，可能需要更长的训练时间
- 准确率波动较大，需要更多的样本平均

## 代码文件

| 文件 | 描述 |
|------|------|
| `experiment2_fixed.py` | 主要实现，包含完整的 MNIST 加载和所有测量 |
| `experiment2_medium.py` | 中等规模版本 |
| `experiment2_mini.py` | 快速测试版本 |
| `experiment2_quick.py` | 快速验证版本 |

## 运行方法

```bash
cd /home/ubuntu/Thermal-DNN-MC-Optimized/py_functions
python3 experiment2_fixed.py
```

## 输出文件

- `experiment2_figure2_*.png` - Figure 2 风格的结果图表
- `experiment2_data_*.npz` - 原始数据文件

## 物理量定义

### 能量 E(t)
$$E(t) = \sum_{\mu,l,i} \Theta(-\Delta_{\mu,l,i}) \Delta_{\mu,l,i}^2$$

其中 $\Delta_{\mu,l,i} = h_{\mu,l,i} \cdot S_{\mu,l,i}$ 是稳定性间隙。

### 自相关函数 c(t, t_w)
$$c(t, t_w) = \frac{1}{N_{dof}} \sum_{\mu,l,i} S_{\mu,l,i}(t) \cdot S_{\mu,l,i}(t_w)$$

### 副本重叠 q(t, t_w)
$$q(t, t_w) = \frac{1}{N_{dof}} \sum_{\mu,l,i} S^{(a)}_{\mu,l,i}(t) \cdot S^{(b)}_{\mu,l,i}(t)$$

其中 (a) 和 (b) 是共享权重但独立演化的两个副本。

## 结论

实验成功复现了论文 Figure 2 的主要特征：
1. 能量呈幂律衰减
2. 准确率随训练提升
3. 系统表现出强记忆性（高自相关）
4. 不同层表现出不同的动态特性

建议后续工作：
1. 增加 MC 步数以获得更稳定的结果
2. 使用更大的数据集（论文使用 2000 训练样本）
3. 进行多次独立运行并取平均
