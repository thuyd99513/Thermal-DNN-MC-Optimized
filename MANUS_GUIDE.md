# Manus AI 继续开发指南

本项目已由 Manus AI 完成了核心优化工作。本指南旨在帮助后续的 Manus AI 实例快速理解项目现状并继续开发。

## 当前状态 (2026-01-27)

- **核心优化已完成**：实现了 `Network_optimized_v3.py`，其中自旋 (S) 和权重 (J) 的更新均已实现完全向量化和 Numba JIT 加速。
- **性能达标**：完整 MC 步的加速比在典型配置下达到了 **37x - 95x**。
- **正确性已验证**：通过了严格的单元测试，确保能量计算与原始串行实现一致。

## 已完成的工作

1. **S 更新优化 (V2)**：利用同层自旋无耦合的物理特性，实现 $M \times N$ 规模的并行更新。
2. **J 更新优化 (V3)**：实现按行并行的权重更新，处理了关键的 `rescale` 归一化逻辑。
3. **自动化测试**：建立了正确性验证 (`test_J_correctness.py`) 和性能基准测试体系 (`benchmark_full_mc.py`)。
4. **详细报告**：在 `reports/` 目录下记录了每一阶段的优化细节和性能数据。

## 建议的后续任务

如果您是新接入的 Manus AI，可以考虑以下方向：

### 1. 进一步性能优化
- **GPU 加速**：目前的优化基于 CPU (Numba/NumPy)。可以尝试使用 `CuPy` 或 `PyTorch` 将计算迁移到 GPU，预期可获得 100x 以上的进一步加速。
- **多线程优化**：进一步调整 Numba 的 `parallel=True` 参数，优化在大规模网络下的多核利用率。

### 2. 功能扩展
- **支持更多势能函数**：目前仅支持软核势能，可以扩展支持其他物理模型。
- **自动化调参**：实现自动化的 $\beta$ (逆温度) 扫描和相变点检测。

### 3. 数据分析与可视化
- **实时能量监控**：开发一个实时显示能量演化和自旋状态的仪表盘。
- **分层结构分析**：编写脚本自动分析并可视化"固-液-固"分层现象。

## 给 Manus 的提示

- **环境准备**：确保安装了 `numba` (`pip install numba`)。
- **JIT 预热**：在运行正式模拟前，务必调用 `warmup_jit()` 以避免初次编译带来的延迟。
- **参考文档**：优先阅读 `reports/J_optimization_report.md` 了解最新的技术细节。

---

## 附录：历史文档 (V1/V2)

### 关键文件说明

| 文件 | 说明 | 状态 |
|------|------|------|
| `py_functions/Network.py` | 原始实现 | 参考 |
| `py_functions/Network_optimized_v2.py` | 仅优化 S 更新的版本 | 稳定 |
| `py_functions/Network_optimized_v3.py` | S 和 J 均优化的版本 ⭐ | **推荐使用** |

### 能量计算详解

#### 软核势能函数
当 gap `h < 0` 时，系统受到惩罚（能量增加）：$V(h) = h^2$。

#### Part Gap 方法
当自旋 `S[mu, l, n]` 翻转时，只有 **N+1 个 gap** 受影响。
当权重 `J[n2, n1]` 更新时，受影响的是该行对应的 **M 个样本的 gap**。


---

# 论文实验复现路线图

本文档记录论文 "Liquid and solid layers in a thermal deep learning machine" 中所有实验的复现状态和后续任务计划。

## 复现状态总览

| 实验 | 对应图表 | 状态 | 复杂度 | 优先级 |
|:-----|:--------|:----:|:------:|:------:|
| 液-固相图 | Figure 1b | ✅ 已完成 | 中等 | - |
| 全局训练动态 | Figure 2 | ✅ 已完成 | 中等 | - |
| 层依赖训练动态 | Figure 3 | ❌ 未开始 | 高 | P1 |
| 设计空间结构 | Figure 4 | ❌ 未开始 | 高 | P2 |
| 温度依赖性 | Figure S1 | ❌ 未开始 | 低 | P3 |
| 全局相关函数补充 | SI Sec. S2 | ❌ 未开始 | 低 | P4 |
| 层相关函数补充 | SI Sec. S3 | ❌ 未开始 | 中等 | P4 |
| 网络深度依赖性 | SI Sec. S4 | ❌ 未开始 | 中等 | P5 |
| 重叠参数分布补充 | SI Sec. S5 | ❌ 未开始 | 中等 | P5 |

## 待复现实验详情

### 实验三：层依赖训练动态 (Figure 3) - 优先级 P1

**目的**：揭示不同层的动态特性差异（液态层 vs 固态层）

**测量内容**：
1. **层自相关函数 c_l(t, t_w)**：不同层 l 的自旋自相关
2. **弛豫时间 τ_l^c**：c_l 衰减到 1/e 所需时间，作为 t_w 的函数
3. **层副本相关函数 q_l(t, t_w)**：不同层的副本重叠
4. **最终层重叠 q_l* 和穿透深度 ξ_l**

**预期结果**：
- 中心层（液态）：快速弛豫，τ_l^c 较小
- 边界层（固态）：慢弛豫，τ_l^c 较大
- 穿透深度 ξ_l 与 ln α 线性相关

**实现难度**：高（需要逐层跟踪相关函数）

---

### 实验四：设计空间结构 (Figure 4) - 优先级 P2

**目的**：分析液态层和固态层的参数空间结构

**测量内容**：
1. **重叠参数分布 P(Q_l^ab)**：层 l 的副本重叠分布
2. **重叠矩阵热图**：配置间的相似性矩阵
3. **层次聚类树状图**：使用 Complete Linkage 算法

**预期结果**：
- 液态层（l=5）：P(Q_l^ab) 为单峰高斯分布，无结构
- 固态层（l=9）：P(Q_l^ab) 为双峰分布，存在层次结构

**实现难度**：高（需要实现聚类算法和可视化）

---

### 实验五：温度依赖性 (Figure S1) - 优先级 P3

**目的**：研究温度 T 对训练动态的影响

**测量内容**：
- 不同温度下的 E(t)/E(0)
- 不同温度下的 A(t)

**实现难度**：低（只需修改 β = 1/T 参数）

---

## 建议的执行顺序

1. **实验三**（层依赖训练动态）- 核心物理结果
2. **实验四**（设计空间结构）- 深入理解固态层
3. **实验五**（温度依赖性）- 简单扩展
4. **GPU 加速** - 性能优化
5. **实时可视化** - 工具开发

---

*文档更新时间：2026-01-28*
